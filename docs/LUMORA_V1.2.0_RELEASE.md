# Lumora v1.2.0 - Web Preview & Code Generation Fixes üéâ

## Release Date
November 12, 2025

## Overview
This release fixes two critical issues that were preventing Lumora from working as intended:
1. **Web preview now renders actual UI** instead of showing code or status pages
2. **Automatic code generation works properly** without infinite loops or overwriting manual files

## What's New

### üåê Working Web Preview
The web preview at `localhost:3001` now shows your actual React UI with full interactivity!

**Features**:
- ‚úÖ Renders actual React components from your code
- ‚úÖ Interactive UI (buttons, inputs, state updates work)
- ‚úÖ Auto-refreshes when you save files
- ‚úÖ Shows real-time updates within 1 second
- ‚úÖ Uses React 18 with proper JSX transformation
- ‚úÖ Fallback UI when no code is loaded yet

**Before**: Status page with instructions
**After**: Your actual app running in the browser

### üîÑ Smart Code Generation
Automatic bidirectional conversion now works intelligently!

**Features**:
- ‚úÖ Only generates code when appropriate
- ‚úÖ Never overwrites manually created files
- ‚úÖ Prevents infinite loops with smart debouncing
- ‚úÖ Works seamlessly after `lumora init`
- ‚úÖ Respects `--codegen` flag properly

**How it works**:
- Checks if target file exists and is manually created
- Only generates if file is missing or marked as generated
- Debounces file changes to prevent loops
- Processes initial files correctly on startup

## Breaking Changes
None! This is a bug fix release that makes existing features work properly.

## Installation

### New Installation
```bash
npm install -g lumora-cli@1.2.0
```

### Upgrade from Previous Version
```bash
npm update -g lumora-cli
```

## Usage

### Quick Start
```bash
# Create new project
lumora init my-app
cd my-app

# Start development server
lumora start

# Open web preview
# Browser: http://localhost:3001
# Mobile: Scan QR code in terminal
```

### With Code Generation
```bash
# Enable automatic React ‚Üî Flutter conversion
lumora start --codegen

# Edit src/App.tsx ‚Üí lib/main.dart updates
# Edit lib/main.dart ‚Üí src/App.tsx updates
```

## What You'll Experience

### 1. Web Preview (localhost:3001)

**Initial Load**:
```
üöÄ Lumora Web Preview

üí° Getting Started:
1. Edit src/App.tsx in your project
2. Save the file
3. Watch this page update automatically!

üì± Mobile Preview:
For the full native experience, scan the QR code...
```

**After Editing Files**:
Your actual app renders with:
- Working buttons and interactions
- Live state updates
- Proper styling
- Auto-refresh on changes

### 2. Mobile Preview (Scan QR)

- Native Flutter rendering
- Instant updates via WebSocket
- Full device capabilities
- Production-like performance

### 3. Bidirectional Sync

**Edit React**:
```tsx
// src/App.tsx
export function App() {
  const [count, setCount] = useState(0);
  return (
    <div>
      <h1>Count: {count}</h1>
      <button onClick={() => setCount(count + 1)}>
        Increment
      </button>
    </div>
  );
}
```

**Auto-generates Flutter** (if --codegen enabled):
```dart
// lib/main.dart
class App extends StatefulWidget {
  @override
  State<App> createState() => _AppState();
}

class _AppState extends State<App> {
  int count = 0;
  
  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        Text('Count: $count'),
        ElevatedButton(
          onPressed: () => setState(() => count++),
          child: Text('Increment'),
        ),
      ],
    );
  }
}
```

## Technical Details

### Web Preview Architecture

```
File Change (src/App.tsx)
    ‚Üì
ReactParser ‚Üí Lumora IR
    ‚Üì
WebPreviewServer.updateIR(ir)
    ‚Üì
BidirectionalConverter.generateReact(ir)
    ‚Üì
HTML with React Runtime (CDN)
    ‚Üì
Browser Renders UI
    ‚Üì
Auto-refresh (1s polling)
```

### Code Generation Flow

```
File Watcher Detects Change
    ‚Üì
Check: Is file already being processed?
    ‚Üì No
Add to processing set
    ‚Üì
Parse file ‚Üí Lumora IR
    ‚Üì
Check: Should generate target file?
    ‚Üì Yes (file missing or marked as generated)
Generate code
    ‚Üì
Write to disk
    ‚Üì
Remove from processing set (after 1s)
```

### Smart Generation Logic

```typescript
const shouldGenerate = 
  !fs.existsSync(targetFile) ||  // File doesn't exist
  fs.readFileSync(targetFile, 'utf-8')
    .includes('// Generated by Lumora');  // Or is auto-generated

if (shouldGenerate) {
  // Safe to generate
  fs.writeFileSync(targetFile, generatedCode);
}
```

## Bug Fixes

### Fixed: Web Preview Not Rendering UI
- **Issue**: Web preview showed status page instead of actual UI
- **Cause**: Server wasn't generating React code from IR
- **Fix**: Added React runtime and proper code generation
- **Impact**: Web preview now works as intended

### Fixed: Code Generation Infinite Loops
- **Issue**: Editing files caused infinite generation loops
- **Cause**: No debouncing or smart detection
- **Fix**: Added processing set and smart file detection
- **Impact**: Bidirectional sync works smoothly

### Fixed: Init Overwriting Files
- **Issue**: `lumora start --codegen` would overwrite manually created files
- **Cause**: No check for existing manual files
- **Fix**: Only generate if file is missing or marked as generated
- **Impact**: Safe to use after `lumora init`

## Performance Improvements

- Web preview auto-refresh: 1 second polling (lightweight)
- Debouncing: 1 second delay prevents rapid re-processing
- Smart detection: Skips unnecessary file operations
- Efficient IR updates: Only regenerates when needed

## Files Changed

### packages/lumora-cli/src/services/web-preview-server.ts
- Added React runtime via CDN (React 18 + ReactDOM + Babel)
- Generate actual React code from Lumora IR
- Render interactive UI instead of status page
- Auto-refresh mechanism with polling
- Proper error handling and fallback UI

### packages/lumora-cli/src/commands/start.ts
- Smart code generation detection
- Only generate if file doesn't exist or is marked as generated
- Prevents overwriting manual files during init
- Better initial file processing
- Improved logging and user feedback

## Testing

### Test Web Preview
```bash
# 1. Create project
lumora init test-web
cd test-web

# 2. Start server
lumora start

# 3. Open browser
open http://localhost:3001

# 4. Edit src/App.tsx
# Change heading text

# 5. Save file
# Browser auto-refreshes with new content
```

### Test Code Generation
```bash
# 1. Start with codegen
lumora start --codegen

# 2. Edit React file
echo 'export function App() { return <div>Test</div>; }' > src/App.tsx

# 3. Check Flutter file
cat lib/main.dart
# Should show generated Flutter code

# 4. Edit Flutter file
# Modify lib/main.dart

# 5. Check React file
cat src/App.tsx
# Should show generated React code
```

### Test No Overwriting
```bash
# 1. Create project
lumora init test-safe
cd test-safe

# 2. Files exist (manually created)
ls src/App.tsx lib/main.dart

# 3. Start with codegen
lumora start --codegen

# 4. Check files
cat src/App.tsx
cat lib/main.dart
# Both should be unchanged (not overwritten)

# 5. Edit one file
# Now generation works for changes
```

## Known Limitations

1. **Web Preview Widgets**: Limited to basic React components (div, button, input, etc.)
2. **Complex State**: Advanced state management may not convert perfectly
3. **Styling**: Inline styles only, no CSS modules or styled-components yet
4. **Animations**: Not supported in current IR format
5. **Custom Components**: Require manual mapping in registry

## Roadmap

### v1.3.0 (Next Release)
- [ ] CSS modules support for web preview
- [ ] Better error messages in web preview
- [ ] Source maps for debugging
- [ ] Hot module replacement (HMR)

### v1.4.0
- [ ] Animation support in IR
- [ ] Custom component registry UI
- [ ] Performance profiling dashboard
- [ ] Visual schema editor

### v2.0.0
- [ ] Plugin system
- [ ] Cloud-based dev proxy
- [ ] Team collaboration features
- [ ] CI/CD integration

## Migration Guide

### From v1.1.x to v1.2.0

No migration needed! Just update:

```bash
npm update -g lumora-cli
```

Your existing projects will work immediately with the new features.

### New Projects

```bash
lumora init my-app
cd my-app
lumora start
```

Everything works out of the box!

## Support

### Documentation
- [GitHub](https://github.com/lumora/lumora)
- [Examples](https://github.com/lumora/lumora/tree/main/examples)

### Issues
Report bugs at: https://github.com/lumora/lumora/issues

### Community
- Discord: [Join our server]
- Twitter: [@LumoraFramework]

## Credits

Built with ‚ù§Ô∏è by the Lumora Team for the Kiro AI Hackathon 2025.

Special thanks to:
- React team for the amazing framework
- Flutter team for the powerful mobile toolkit
- Babel team for JSX transformation
- All our early testers and contributors

## License

MIT License - see LICENSE file for details

---

## Quick Commands Reference

```bash
# Installation
npm install -g lumora-cli@1.2.0

# Create project
lumora init my-app

# Start development
lumora start

# With code generation
lumora start --codegen

# Custom port
lumora start --port 4000

# Disable QR code
lumora start --no-qr

# Help
lumora --help
```

## What's Next?

Try it out and let us know what you think!

```bash
npm install -g lumora-cli@1.2.0
lumora init my-awesome-app
cd my-awesome-app
lumora start
```

Open `http://localhost:3001` and see your app come to life! üöÄ
